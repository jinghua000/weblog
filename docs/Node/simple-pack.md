# simple-pack (简易打包)

## 前言

我们这次就来了解一下如何做一个类似[`webpack`](https://webpack.js.org/)的简易打包。

> 本文的实现方式大量参考了 https://github.com/ronami/minipack 这个项目。

## 目标

把一些`es`写法写的文件通过打包让其可以在`node`和`浏览器`环境直接执行。

## 思路整理

因为实在没有思路所以来参考一下`webpack`的实现方式。

根据`webpack`的打包结果(可以在`development`模式下的打包结果中看到)，先忽略里面的具体内容，大概的结构是这样的。

```js
// 自执行函数
(function (modules) {

  // 引入模块的方法
  function require (
    // ...
  ) {
    // ...
  }

  // 引入入口文件
  require(
    //...
  )

})({
  // 每个文件的内容 modules对象
  // ...
})
```

根据这个格式我们来自己实现打包所需要的点是：

1. 把`es`的代码转换成`cjs`的代码。
2. 读取每个文件的代码，并通过一定格式存放在`modules对象`里。
3. 提取出每个文件依赖的内容，并从`modules对象`中加载所需要的内容。
4. 因为要在浏览器环境运行，所以需要定义`require`，`exports`等`node`环境存在但是`浏览器`环境不存在的变量。

## 实现

在实现之前先来整理一下我们需要的所有依赖。

不过...在整理依赖之前我们先要学习一个知识点。

